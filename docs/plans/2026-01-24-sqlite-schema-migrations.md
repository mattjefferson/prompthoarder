# SQLite Schema + Migrations

## Goals
- Define the v1 schema for prompts, tags, categories, workflows, and FTS.
- Provide a GRDB `DatabaseMigrator` for initial setup.
- Keep the schema aligned with plan.md and future migrations.

## Assumptions
- Dates are stored as ISO8601 strings (encoding configured at DatabaseManager later).
- FTS5 uses GRDB `synchronize(withTable:)` to generate triggers.
- `sqlite_id INTEGER PRIMARY KEY` is the rowid alias used by FTS.

## Tables
- `prompts`: UUID id, file_path, category_id, favorite/archive flags, content hash, body_cache, timestamps, usage count.
- `tags`: unique name (case-insensitive).
- `categories`: unique name (case-insensitive).
- `prompt_tags`: join table (prompt_id, tag_id).
- `workflows`: id, title, description, timestamps.
- `workflow_steps`: workflow_id, prompt_id, order_index, notes, variable_overrides JSON.

## FTS5
- `prompts_fts` virtual table indexes `title` and `body_cache`.
- External content table `prompts` with triggers generated by GRDB.

## Indices
- `prompts`: indices for `category_id`, `is_favorite`, `is_archived`, `updated_at`.
- `prompt_tags`: index on `tag_id`.
- `workflow_steps`: indices on `workflow_id`, `prompt_id`.

## Tests
- In-memory migration test verifies all tables and indices exist.
